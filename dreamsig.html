<!DOCTYPE html>
<html>
    <meta charset="utf-8"/>
    <head>
        <title>Dream Signature</title>
        <link rel="stylesheet" type="text/css"  href="shared.css" />
    </head>
    <body onload="uncheck_all()">
        <a href="index.html">&lt;Tool Hub</a>
        <h1 id="title">Dream Signature Generator</h1>
        <h2 id="subtitle">Use this tool to choose and arrange images to describe a recorded dream.</h2><br>
        <p>FIRST, select anything important to the dream:</p>
        <form id="checkbox_form">
        <input type="checkbox" id="flight" onClick="alter_buddy_list(this.id)" value="flight" name="sigils"><label for="flight"> flight, freedom, exploration</label><br>
        <input type="checkbox" id="alien" onClick="alter_buddy_list(this.id)" value="alien" name="sigils"><label for="alien"> alienness, surrealness, unfamiliarity</label><br>
        <input type="checkbox" id="shelter" onClick="alter_buddy_list(this.id)" value="shelter" name="sigils"><label for="shelter"> shelter, indoors, security</label><br>
        <input type="checkbox" id="powers" onClick="alter_buddy_list(this.id)" value="powers" name="sigils"><label for="powers"> powers, enhancement, magic</label><br>
        <input type="checkbox" id="discovery" onClick="alter_buddy_list(this.id)" value="discovery" name="sigils"><label for="discovery"> discovery, knowledge, education</label><br>
        <input type="checkbox" id="discomfort" onClick="alter_buddy_list(this.id)" value="discomfort" name="sigils"><label for="fear"> fear, discomfort, unease</label><br>
        <input type="checkbox" id="friendship" onClick="alter_buddy_list(this.id)" value="friendship" name="sigils"><label for="friendship"> friendship, companion, assistance</label><br>
        <input type="checkbox" id="embarrassment" onClick="alter_buddy_list(this.id)" value="embarrassing" name="sigils"><label for="embarrassing"> embarrassment, humiliation, rejection</label><br>
        <input type="checkbox" id="nature" onClick="alter_buddy_list(this.id)" value="nature" name="sigils"><label for="nature"> nature, plants, growth</label><br>
        <input type="checkbox" id="combat" onClick="alter_buddy_list(this.id)" value="combat" name="sigils"><label for="combat"> combat, aggression, anger</label><br>
        <input type="checkbox" id="ocean" onClick="alter_buddy_list(this.id)" value="ocean" name="sigils"><label for="ocean"> ocean, water, storms</label><br>
        <input type="checkbox" id="wounds" onClick="alter_buddy_list(this.id)" value="wounds" name="sigils"><label for="wounds"> wounds, gore, disease</label><br>
        <input type="checkbox" id="space" onClick="alter_buddy_list(this.id)" value="space" name="sigils"><label for="space"> space, emptiness, void</label><br>
        <input type="checkbox" id="music" onClick="alter_buddy_list(this.id)" value="music" name="sigils"><label for="music"> music, sound, song</label><br>
        <input type="checkbox" id="time" onClick="alter_buddy_list(this.id)" value="time" name="sigils"><label for="powers"> time, chronology, progress</label><br>
        <input type="checkbox" id="destiny" onClick="alter_buddy_list(this.id)" value="destiny" name="sigils"><label for="destiny"> destiny, duty, mission</label><br>
        <input type="checkbox" id="secrecy" onClick="alter_buddy_list(this.id)" value="secrecy" name="sigils"><label for="secrecy"> secrecy, conspiracy, cults</label><br>
        <input type="checkbox" id="sorrow" onClick="alter_buddy_list(this.id)" value="sorrow" name="sigils"><label for="sorrow"> sorrow, loss, grieving</label><br>
        <input type="checkbox" id="lucid" onClick="alter_buddy_list(this.id)" value="lucid" name="sigils"><label for="lucidity"> This was a lucid dream</label><br> 
        <br></form>
        <p>NOT WORKING YET, BUT SOON(TM): drag and drop to arrange to your liking:</p>
        <div id="light_div"></div><br>
        <span>FINALLY, hit the button to copy your code to your clipboard (Ctrl+V to use):</span><input type="button" id="printout" onClick="printout(this.id)" value="Copy"><br>
        <div id="out_div"></div><br>
        <script type="text/javascript">

            thread_url = "http://www1.flightrising.com/forums/gend/2593123"

            mapping = { "flight": "https://i.imgur.com/nSTdg6R.png",
                        "alien": "https://i.imgur.com/gciH2Oc.png",
                        "embarrassment": "https://i.imgur.com/mgso61R.png",
                        "nature": "https://i.imgur.com/flDElsB.png",
                        "discomfort": "https://i.imgur.com/MDZ3rVU.png",
                        "discovery": "https://i.imgur.com/kFfQCmO.png",
                        "friendship": "https://i.imgur.com/4s6Iakb.png",
                        "shelter": "https://i.imgur.com/IXZhdwx.png",
                        "combat": "https://i.imgur.com/hCPXA5P.png",
                        "ocean": "https://i.imgur.com/AkOZ5Yr.png",
                        "space": "https://i.imgur.com/qRcbzcW.png",
                        "destiny": "https://i.imgur.com/94eMM9c.png",
                        "time": "https://i.imgur.com/9C9oHu8.png",
                        "wounds": "https://i.imgur.com/M1M3TbG.png",
                        "powers": "https://i.imgur.com/QxphrKe.png",
                        "music": "https://i.imgur.com/v0pG4F0.png",
                        "secrecy": "https://i.imgur.com/iyclcTv.png",
                        "sorrow": "https://i.imgur.com/QMnIMdV.png",
                        "lucid": "https://i.imgur.com/FU8J6iH.gif"
                    }

            var selected_buddies = []

            function printout(identifier) {
                var clicked = document.getElementById(identifier);
                var target = document.getElementById("out_div");
                var outstring = "";
                var lead = "[url="+thread_url+"][img]";
                var follow = "[/img][/url]";
                for(var i = 0; i < selected_buddies.length ; i++){
                    bud = selected_buddies[i];
                    outstring += lead + mapping[bud] + follow;
                }
                var textArea = document.createElement("textarea");
                textArea.style.width = '2em';
                textArea.style.height = '2em';
                textArea.style.background = 'transparent';
                textArea.value = outstring;
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                document.execCommand("copy");
                document.body.removeChild(textArea);
                clicked.value = "Copied"
                setTimeout(function(){ 
                    clicked.value = "Copy";
                }, 1000);
                        }

            function alter_buddy_list(selecting_id){
                var checkbox = document.getElementById(selecting_id);
                var offset = selected_buddies.indexOf(selecting_id);
                var is_deployed = offset >= 0;
                if (!checkbox.checked && is_deployed){
                    selected_buddies.splice(offset, 1);
                    var del = document.getElementById(selecting_id+"_buddy");
                    del.parentNode.removeChild(del);
                }
                else if (checkbox.checked && !is_deployed){
                    selected_buddies.push(selecting_id);
                    create_buddy(selecting_id, document.getElementById("light_div"));
                }
            }

            function create_buddy(identifier, parent){
                new_bud = document.createElement('img');
                new_bud.id = identifier+"_buddy";
                if(identifier == "lucid"){
                    new_bud.src = "dreamicons/"+identifier+".gif";
                } else {
                    new_bud.src = "dreamicons/"+identifier+".png";
                }
                new_bud.draggable = true;
                new_bud.ondragstart = "drag(event)";
                new_bud.ondrop="drop(event)";
                new_bud.ondragover="allowDrop(event)"
                parent.appendChild(new_bud);
            }

            // Blindly copied from W3:
            function allowDrop(ev) {
              ev.preventDefault();
            }

            function drag(ev) {
              ev.dataTransfer.setData("text", ev.target.id);
            }

            function drop(ev) {
              ev.preventDefault();
              var data = ev.dataTransfer.getData("text");
              ev.target.appendChild(document.getElementById(data));
            }

            // Blindly copied from SO:
            function uncheck_all(){ 
                  var w = document.getElementsByTagName('input'); 
                  for(var i = 0; i < w.length; i++){ 
                    if(w[i].type=='checkbox'){ 
                      w[i].checked = false; 
                    }
                  }
            } 
        </script>
    </body>
</html>